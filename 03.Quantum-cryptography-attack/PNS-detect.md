# 2.3. Practical Security Vulnerabilities and Attack Vectors in Real-World QKD Implementations

## Introduction

While quantum key distribution protocols like BB84 provide information-theoretic security in theory, practical implementations introduce vulnerabilities that can be exploited by sophisticated adversaries. The gap between theoretical security proofs and real-world implementations creates attack vectors that compromise the security guarantees of QKD systems.

Real-world QKD systems face challenges from imperfect components, environmental factors, and implementation shortcuts that deviate from ideal theoretical assumptions. Among these vulnerabilities, **Photon Number Splitting (PNS) attacks** represent the most significant threat to practical QKD systems, while **Trojan Horse attacks** exploit optical vulnerabilities in quantum sources.

## Overview of Practical Attack Vectors

**Major Attack Categories:**
- **Photon Number Splitting (PNS)**: Exploiting multi-photon pulses from imperfect sources
- **Trojan Horse Attacks**: Injecting light into quantum sources to extract state information
- **Detector-Based Attacks**: Time-shift attacks, detector blinding, efficiency mismatch
- **Side-Channel Attacks**: Electromagnetic emanations, optical leakage, timing correlations
- **Implementation Loopholes**: Calibration vulnerabilities, classical processing flaws

The following sections focus primarily on PNS and Trojan Horse attacks, with brief coverage of other vulnerabilities.

## 2.3.1. Photon Number Splitting Attack and Weak Coherent Pulse Vulnerabilities

### The Single Photon Source Challenge

The ideal BB84 protocol assumes the use of perfect single-photon sources that emit exactly one photon per pulse with unit probability. However, in reality, implementing true single-photon sources presents significant technological challenges that make them nearly impossible to implement in practical quantum key distribution systems.

**Challenges in Single Photon Source Implementation:**

1. **Deterministic Single Photon Generation**: Creating a source that produces exactly one photon on demand with high efficiency remains technologically challenging
2. **High Dark Count Rates**: Single photon detectors suffer from noise and false positive detections
3. **Low Efficiency**: Current single photon sources have low emission probabilities and coupling efficiencies
4. **Timing Synchronization**: Precise timing between source emission and detector gates is difficult to maintain
5. **Cost and Complexity**: Single photon sources require complex setups with cooling systems and stabilization

### Practical Alternative: Weak Coherent Pulses

Due to these implementation challenges, practical BB84 systems use **weak coherent pulses** (WCP) generated by heavily attenuated laser sources instead of true single photon sources.

### Mathematical Foundation of Weak Coherent Pulses

**Photon Number Distribution:**
A weak coherent pulse is described by a coherent state $|\alpha\rangle$ where $\alpha$ is the complex amplitude. The photon number distribution follows a Poisson distribution:

$P(n) = \frac{|\alpha|^2 e^{-|\alpha|^2}}{n!} = \frac{\mu^n e^{-\mu}}{n!}$

where $\mu = |\alpha|^2$ is the mean photon number per pulse.

**Key Probabilities:**
- Probability of empty pulse (vacuum): $P(0) = e^{-\mu}$
- Probability of single photon: $P(1) = \mu e^{-\mu}$
- Probability of multi-photon: $P(n \geq 2) = 1 - e^{-\mu} - \mu e^{-\mu} = 1 - e^{-\mu}(1 + \mu)$

**Optimal Mean Photon Number:**
For practical QKD systems, the mean photon number $\mu$ is typically chosen to be around $0.1$ to $0.5$. For $\mu = 0.1$:

- $P(0) = e^{-0.1} \approx 0.905$ (90.5% empty pulses)
- $P(1) = 0.1 \times e^{-0.1} \approx 0.090$ (9.0% single photon)
- $P(n \geq 2) \approx 0.005$ (0.5% multi-photon)

### Physical Foundation of Weak Coherent Pulses

**How to Create WCP:**
Weak coherent pulses are generated using a straightforward laser-based system as shown in the implementation diagram:

1. **TTL Control Signal**: Digital timing signals control the pulse generation timing
2. **Pulse Driver**: Converts TTL signals into appropriate electrical pulses for laser modulation
3. **TEC Controller**: Thermoelectric cooler maintains stable laser temperature for wavelength stability
4. **Laser Diode**: Standard telecommunications laser diode (typically 1550nm) serves as the coherent light source
5. **Optical Output**: Laser light is coupled into optical fiber for transmission
6. **Attenuation Stage**: Strong optical attenuation (60-80 dB) reduces intensity to weak coherent pulse levels
7. **State Encoding**: Polarization modulators encode BB84 quantum states

**Why WCP is Easier than Single Photons:**
- **Standard Telecom Components**: Uses commercially available laser diodes and fiber optic components
- **Simple Electronics**: Basic TTL timing signals and standard laser drivers
- **Temperature Stabilization**: Only requires thermoelectric cooling (not cryogenic temperatures)
- **Scalable Design**: Easy to integrate multiple channels for high-speed operation
- **Fiber Integration**: Direct compatibility with existing telecommunications infrastructure
- **Cost Effective**: Orders of magnitude cheaper than quantum dot or parametric down-conversion sources
- **Reliable Operation**: Mature semiconductor laser technology with long operational lifetimes

**Physical Nature of Multi-Photon Pulses:**
The laser diode produces coherent light in a coherent state $|\alpha\rangle$, where all photons generated in each pulse are **identical copies** with the same:
- Wavelength (determined by laser diode bandgap and temperature)
- Polarization state (controlled by external modulators)
- Spatial mode (single-mode fiber coupling)
- Temporal profile (shaped by pulse driver electronics)
- Phase relationship (coherent with fixed phase)

**Why Eve Can Attack Multi-Photon Pulses:**
The identical nature of laser-generated photons creates the fundamental security vulnerability:

1. **Perfect Copying Capability**: Since all photons in a multi-photon pulse from the laser diode are identical, Eve can split the beam and keep one photon while forwarding the others
2. **No-Cloning Limitation Bypassed**: The no-cloning theorem prevents copying *unknown* quantum states, but multi-photon pulses contain multiple copies of the *same* quantum state
3. **Lossless Information Extraction**: Eve can measure one photon to determine the quantum state, then apply this knowledge to extract complete information
4. **Coherent State Properties**: The coherent nature of laser light means all photons share identical quantum properties, enabling perfect state reconstruction

**Physical Attack Implementation:**
- **Beam Splitting**: Simple optical beam splitters can divide multi-photon pulses
- **Optical Storage**: Delay lines store photons until basis reconciliation occurs
- **Photon Number Detection**: Quantum non-demolition measurements identify multi-photon events
- **State Reconstruction**: Measurement of one identical photon reveals the state of all others in the pulse

The simplicity of the laser-based WCP generation system, while enabling practical QKD implementation, inherently creates the multi-photon vulnerability that sophisticated eavesdroppers can exploit.

### Photon Number Splitting Attack

The presence of multi-photon pulses creates a fundamental security vulnerability. When a pulse contains multiple photons, an eavesdropper (Eve) can perform a **photon-number-splitting (PNS) attack**:

**PNS Attack Strategy:**
1. Eve intercepts all pulses and performs non-demolition photon number measurement
2. Eve blocks all single-photon and empty pulses (causing transmission loss)
3. For multi-photon pulses, Eve keeps one photon for measurement after basis reconciliation
4. Eve forwards the remaining photons to Bob
5. This attack introduces no additional errors but gives Eve full information about multi-photon events

**Attack Effectiveness:**
For a weak coherent pulse with mean photon number $\mu$, the fraction of pulses vulnerable to PNS attack is:

$f_{PNS} = \frac{P(n \geq 2)}{P(n \geq 1)} = \frac{1 - e^{-\mu}(1 + \mu)}{1 - e^{-\mu}}$

For $\mu = 0.1$: $f_{PNS} \approx 0.053$ (5.3% of detected pulses)

### Security Analysis and Mathematical Problems

**Information Leakage:**
The secure key rate for WCP-based BB84 becomes:

$R_{WCP} = P(1) \cdot [1 - h(Q_1)] - P(n \geq 2) \cdot 1$

where $Q_1$ is the error rate for single-photon pulses, and the multi-photon contribution is assumed to be completely known to Eve.

**Distance Limitation:**
The channel transmission probability $\eta$ affects the security differently for single and multi-photon pulses:

- Single photon detection rate: $P(1) \cdot \eta$  
- Multi-photon detection rate: $P(n \geq 2) \cdot [1 - (1-\eta)^n] \approx P(n \geq 2) \cdot n\eta$ for small $\eta$

**GLLP Security Bound:**
The Gottesman-Lo-LÃ¼tkenhaus-Preskill (GLLP) bound provides rigorous security analysis for WCP-based BB84:

$R \geq -\mu \eta f(E_\mu) + \mu^2 \eta^2 Y_2$

where $E_\mu$ is the overall error rate, $Y_2$ is the two-photon yield, and $f(E_\mu) = 1 + E_\mu \log_2(E_\mu) + (1-E_\mu)\log_2(1-E_\mu)$.

### Countermeasures: Decoy State Protocol

The most effective solution to multi-photon vulnerabilities is the **decoy state protocol**, which uses multiple intensity levels:

$\mu_{signal} > \mu_{decoy} > 0$

By comparing statistics from different intensities, legitimate parties can estimate single-photon parameters and detect PNS attacks. The decoy state key rate becomes:

$R_{decoy} = Y_1 [1 - h(e_1)] - f_E h(E_\mu)$

where $Y_1$ and $e_1$ are estimated single-photon yield and error rate.